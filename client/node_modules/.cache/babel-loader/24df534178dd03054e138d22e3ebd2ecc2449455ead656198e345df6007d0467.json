{"ast":null,"code":"import _objectSpread from\"/home/agreus/Documents/webdev/mercury-messenger/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/home/agreus/Documents/webdev/mercury-messenger/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useContext,useState,useEffect}from\"react\";import{useNavigate}from\"react-router-dom\";// components\nimport NewChannelForm from\"../components/forms/NewChannelForm\";//context\nimport{DataContext}from\"../components/context/DataContext\";import{FlashContext}from\"../components/context/FlashContext\";// utility hooks\nimport axiosInstance from\"../utils/axios\";import{jsx as _jsx}from\"react/jsx-runtime\";function NewChannelPage(){var _useContext=useContext(DataContext),setGroupData=_useContext.setGroupData,selectedGroup=_useContext.selectedGroup,setSelectedChannel=_useContext.setSelectedChannel,isAdmin=_useContext.isAdmin;var _useContext2=useContext(FlashContext),pushFlashMessage=_useContext2.pushFlashMessage;var _useState=useState({message:null,status:null}),_useState2=_slicedToArray(_useState,2),axiosErr=_useState2[0],setAxiosErr=_useState2[1];var _axiosInstance=axiosInstance(),userChannels=_axiosInstance.userChannels;var navigate=useNavigate();useEffect(function(){if(selectedGroup){if(!isAdmin()){pushFlashMessage([{message:\"Access denied\",type:\"error\"}]);navigate(\"/\");}}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[selectedGroup]);function newChannelHandler(channelObject){var newChannelData=new FormData();newChannelData.append(\"group\",channelObject.group);newChannelData.append(\"name\",channelObject.name);newChannelData.append(\"type\",channelObject.type);userChannels.new(newChannelData).then(function(res){setSelectedChannel(null);setGroupData(function(prevData){var dataCopy=_objectSpread({},prevData);dataCopy[res.data.groupId].channels.text.push(res.data.channelData);dataCopy[res.data.groupId].chatData[res.data.channelData._id]=[];return dataCopy;});pushFlashMessage(res.data.messages);navigate(\"/g/\".concat(selectedGroup.name));}).catch(function(err){setAxiosErr({message:err.response.data.messages[0].message,status:err.response.status});});}return/*#__PURE__*/_jsx(NewChannelForm,{onNewChannel:newChannelHandler,err:axiosErr});}export default NewChannelPage;","map":{"version":3,"names":["useContext","useState","useEffect","useNavigate","NewChannelForm","DataContext","FlashContext","axiosInstance","NewChannelPage","setGroupData","selectedGroup","setSelectedChannel","isAdmin","pushFlashMessage","message","status","axiosErr","setAxiosErr","userChannels","navigate","type","newChannelHandler","channelObject","newChannelData","FormData","append","group","name","new","then","res","prevData","dataCopy","data","groupId","channels","text","push","channelData","chatData","_id","messages","catch","err","response"],"sources":["/home/agreus/Documents/webdev/mercury-messenger/client/src/pages/NewChannelPage.js"],"sourcesContent":["import { useContext, useState, useEffect } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\n\n// components\nimport NewChannelForm from \"../components/forms/NewChannelForm\";\n\n//context\nimport { DataContext } from \"../components/context/DataContext\";\nimport { FlashContext } from \"../components/context/FlashContext\";\n\n// utility hooks\nimport axiosInstance from \"../utils/axios\";\n\nfunction NewChannelPage() {\n  const { setGroupData, selectedGroup, setSelectedChannel, isAdmin } =\n    useContext(DataContext);\n  const { pushFlashMessage } = useContext(FlashContext);\n  const [axiosErr, setAxiosErr] = useState({\n    message: null,\n    status: null,\n  });\n  const { userChannels } = axiosInstance();\n\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    if (selectedGroup) {\n      if (!isAdmin()) {\n        pushFlashMessage([{ message: \"Access denied\", type: \"error\" }]);\n        navigate(\"/\");\n      }\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [selectedGroup]);\n\n  function newChannelHandler(channelObject) {\n    let newChannelData = new FormData();\n    newChannelData.append(\"group\", channelObject.group);\n    newChannelData.append(\"name\", channelObject.name);\n    newChannelData.append(\"type\", channelObject.type);\n\n    userChannels\n      .new(newChannelData)\n      .then((res) => {\n        setSelectedChannel(null);\n\n        setGroupData((prevData) => {\n          const dataCopy = { ...prevData };\n\n          dataCopy[res.data.groupId].channels.text.push(res.data.channelData);\n          dataCopy[res.data.groupId].chatData[res.data.channelData._id] = [];\n          return dataCopy;\n        });\n\n        pushFlashMessage(res.data.messages);\n        navigate(`/g/${selectedGroup.name}`);\n      })\n      .catch((err) => {\n        setAxiosErr({\n          message: err.response.data.messages[0].message,\n          status: err.response.status,\n        });\n      });\n  }\n\n  return <NewChannelForm onNewChannel={newChannelHandler} err={axiosErr} />;\n}\n\nexport default NewChannelPage;\n"],"mappings":"uRAAA,OAASA,UAAU,CAAEC,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CACvD,OAASC,WAAW,KAAQ,kBAAkB,CAE9C;AACA,MAAOC,eAAc,KAAM,oCAAoC,CAE/D;AACA,OAASC,WAAW,KAAQ,mCAAmC,CAC/D,OAASC,YAAY,KAAQ,oCAAoC,CAEjE;AACA,MAAOC,cAAa,KAAM,gBAAgB,CAAC,2CAE3C,QAASC,eAAc,EAAG,CACxB,gBACER,UAAU,CAACK,WAAW,CAAC,CADjBI,YAAY,aAAZA,YAAY,CAAEC,aAAa,aAAbA,aAAa,CAAEC,kBAAkB,aAAlBA,kBAAkB,CAAEC,OAAO,aAAPA,OAAO,CAEhE,iBAA6BZ,UAAU,CAACM,YAAY,CAAC,CAA7CO,gBAAgB,cAAhBA,gBAAgB,CACxB,cAAgCZ,QAAQ,CAAC,CACvCa,OAAO,CAAE,IAAI,CACbC,MAAM,CAAE,IACV,CAAC,CAAC,wCAHKC,QAAQ,eAAEC,WAAW,eAI5B,mBAAyBV,aAAa,EAAE,CAAhCW,YAAY,gBAAZA,YAAY,CAEpB,GAAMC,SAAQ,CAAGhB,WAAW,EAAE,CAE9BD,SAAS,CAAC,UAAM,CACd,GAAIQ,aAAa,CAAE,CACjB,GAAI,CAACE,OAAO,EAAE,CAAE,CACdC,gBAAgB,CAAC,CAAC,CAAEC,OAAO,CAAE,eAAe,CAAEM,IAAI,CAAE,OAAQ,CAAC,CAAC,CAAC,CAC/DD,QAAQ,CAAC,GAAG,CAAC,CACf,CACF,CACA;AACF,CAAC,CAAE,CAACT,aAAa,CAAC,CAAC,CAEnB,QAASW,kBAAiB,CAACC,aAAa,CAAE,CACxC,GAAIC,eAAc,CAAG,GAAIC,SAAQ,EAAE,CACnCD,cAAc,CAACE,MAAM,CAAC,OAAO,CAAEH,aAAa,CAACI,KAAK,CAAC,CACnDH,cAAc,CAACE,MAAM,CAAC,MAAM,CAAEH,aAAa,CAACK,IAAI,CAAC,CACjDJ,cAAc,CAACE,MAAM,CAAC,MAAM,CAAEH,aAAa,CAACF,IAAI,CAAC,CAEjDF,YAAY,CACTU,GAAG,CAACL,cAAc,CAAC,CACnBM,IAAI,CAAC,SAACC,GAAG,CAAK,CACbnB,kBAAkB,CAAC,IAAI,CAAC,CAExBF,YAAY,CAAC,SAACsB,QAAQ,CAAK,CACzB,GAAMC,SAAQ,kBAAQD,QAAQ,CAAE,CAEhCC,QAAQ,CAACF,GAAG,CAACG,IAAI,CAACC,OAAO,CAAC,CAACC,QAAQ,CAACC,IAAI,CAACC,IAAI,CAACP,GAAG,CAACG,IAAI,CAACK,WAAW,CAAC,CACnEN,QAAQ,CAACF,GAAG,CAACG,IAAI,CAACC,OAAO,CAAC,CAACK,QAAQ,CAACT,GAAG,CAACG,IAAI,CAACK,WAAW,CAACE,GAAG,CAAC,CAAG,EAAE,CAClE,MAAOR,SAAQ,CACjB,CAAC,CAAC,CAEFnB,gBAAgB,CAACiB,GAAG,CAACG,IAAI,CAACQ,QAAQ,CAAC,CACnCtB,QAAQ,cAAOT,aAAa,CAACiB,IAAI,EAAG,CACtC,CAAC,CAAC,CACDe,KAAK,CAAC,SAACC,GAAG,CAAK,CACd1B,WAAW,CAAC,CACVH,OAAO,CAAE6B,GAAG,CAACC,QAAQ,CAACX,IAAI,CAACQ,QAAQ,CAAC,CAAC,CAAC,CAAC3B,OAAO,CAC9CC,MAAM,CAAE4B,GAAG,CAACC,QAAQ,CAAC7B,MACvB,CAAC,CAAC,CACJ,CAAC,CAAC,CACN,CAEA,mBAAO,KAAC,cAAc,EAAC,YAAY,CAAEM,iBAAkB,CAAC,GAAG,CAAEL,QAAS,EAAG,CAC3E,CAEA,cAAeR,eAAc"},"metadata":{},"sourceType":"module","externalDependencies":[]}