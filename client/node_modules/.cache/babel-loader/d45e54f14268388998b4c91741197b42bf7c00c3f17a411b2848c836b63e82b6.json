{"ast":null,"code":"import _toConsumableArray from\"/home/agreus/Documents/webdev/mercury-messenger/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"/home/agreus/Documents/webdev/mercury-messenger/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/home/agreus/Documents/webdev/mercury-messenger/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useEffect,useState}from\"react\";import{PaperAirplaneIcon,TrashIcon,ExclamationCircleIcon}from\"@heroicons/react/outline\";// modal\nimport{ImageExpandedModal}from\"../ui/Modal\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function FailedActions(props){var _props$retryObject=props.retryObject,clusterData=_props$retryObject.clusterData,actions=_props$retryObject.actions,failedIndex=_props$retryObject.failedIndex,chatLocation=_props$retryObject.chatLocation;var content=clusterData.content;var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),opacity=_useState2[0],setOpacity=_useState2[1];function executeRetry(){failedIndex.forEach(function(index){var _content$index$failed=content[index].failed,message=_content$index$failed.message,target=_content$index$failed.target,status=_content$index$failed.status,parent=_content$index$failed.parent;if(index===0)actions.sendMessage({message:_objectSpread({},message),target:_objectSpread({},target),failed:status});else actions.appendMessage({message:_objectSpread({},message),target:_objectSpread({},target),parent:_objectSpread({},parent),failed:status});});}function executeLocalRemove(){var deletionData={target:{group:chatLocation.group,channel:chatLocation.channel,clusterTimestamp:clusterData.clusterTimestamp}};// parent failed to send\nif(failedIndex.includes(0)){deletionData.deleteCluster=true;}// child failed to send\nelse{deletionData.indexes=_toConsumableArray(failedIndex);}actions.removeClusterLocally(deletionData);}useEffect(function(){var opacityTimer=setTimeout(function(){setOpacity(\"opacity-0 transition-opacity duration-700\");// why does this not work? : solution, only this component must update, does not work if nested in other component, this retry component was nested in message\n},2000);return function(){clearTimeout(opacityTimer);};});return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-500 shadow-md w-1/4 max-w-[9rem] h-6 max-h-6 m-0.5 rounded-md flex justify-around shrink-0 self-baseline relative cursor-pointer \".concat(props.className),children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-full h-6 bg-mexican-red-400 text-center rounded-md font-semibold absolute z-10 pointer-events-none \".concat(opacity,\" text-ellipsis overflow-hidden\"),children:\"failed to send\"}),/*#__PURE__*/_jsx(\"span\",{title:\"delete\",className:\"w-full flex rounded-l-md justify-center hover:bg-gray-400 transition-colors duration-75 group\",onClick:executeLocalRemove,children:/*#__PURE__*/_jsx(TrashIcon,{className:\"h-full py-0.5 text-gray-900\"})}),/*#__PURE__*/_jsx(\"span\",{className:\"h-3/4 self-center outline outline-1 outline-gray-800 absolute\"}),/*#__PURE__*/_jsx(\"span\",{title:\"retry\",className:\"w-full flex rounded-r-md justify-center hover:bg-gray-400 transition-colors duration-75 group\",onClick:executeRetry,children:/*#__PURE__*/_jsx(PaperAirplaneIcon,{className:\"h-full py-0.5 text-gray-900 rotate-90\"})})]});}function ImageThumbnail(props){var imageObject=props.imageObject,pending=props.pending;var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),imageExpanded=_useState4[0],setImageExpanded=_useState4[1];if(pending){return/*#__PURE__*/_jsx(\"div\",{className:\"w-36 h-24 my-1 rounded-md bg-gray-500 animate-pulse\"});}return/*#__PURE__*/_jsxs(_Fragment,{children:[imageExpanded?/*#__PURE__*/_jsx(ImageExpandedModal,{imgSrc:imageObject.url,toggle:function toggle(){return setImageExpanded(!setImageExpanded);}}):null,/*#__PURE__*/_jsx(\"img\",{className:\"w-full md:w-1/2 max-w-[20rem] my-1 rounded-md cursor-pointer\",src:imageObject.reduced,alt:\"attached\",onClick:function onClick(){return setImageExpanded(!imageExpanded);}})]});}function Message(props){var text=props.text,image=props.image,failed=props.failed,pending=props.pending,retryObject=props.retryObject;return/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-[1.75rem] w-full \".concat(pending||failed?\"opacity-50\":null,\" flex justify-between items-center\"),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"w-full\",children:[image?/*#__PURE__*/_jsx(ImageThumbnail,{imageObject:image,pending:pending}):null,/*#__PURE__*/_jsx(\"span\",{className:\"w-full pr-2 font-semibold text-md text-gray-900 break-words\",children:text})]}),retryObject?/*#__PURE__*/_jsx(FailedActions,{retryObject:retryObject,className:pending||failed?null:\"opacity-50\"}):failed?/*#__PURE__*/_jsx(ExclamationCircleIcon,{className:\"h-6 text-mexican-red-600\"}):null]});}export default Message;","map":{"version":3,"names":["useEffect","useState","PaperAirplaneIcon","TrashIcon","ExclamationCircleIcon","ImageExpandedModal","FailedActions","props","retryObject","clusterData","actions","failedIndex","chatLocation","content","opacity","setOpacity","executeRetry","forEach","index","failed","message","target","status","parent","sendMessage","appendMessage","executeLocalRemove","deletionData","group","channel","clusterTimestamp","includes","deleteCluster","indexes","removeClusterLocally","opacityTimer","setTimeout","clearTimeout","className","ImageThumbnail","imageObject","pending","imageExpanded","setImageExpanded","url","reduced","Message","text","image"],"sources":["/home/agreus/Documents/webdev/mercury-messenger/client/src/components/chat/Message.js"],"sourcesContent":["import { useEffect, useState } from \"react\";\nimport {\n  PaperAirplaneIcon,\n  TrashIcon,\n  ExclamationCircleIcon,\n} from \"@heroicons/react/outline\";\n\n// modal\nimport { ImageExpandedModal } from \"../ui/Modal\";\n\nfunction FailedActions(props) {\n  const { clusterData, actions, failedIndex, chatLocation } = props.retryObject;\n  const content = clusterData.content;\n  const [opacity, setOpacity] = useState(\"\");\n\n  function executeRetry() {\n    failedIndex.forEach((index) => {\n      const { message, target, status, parent } = content[index].failed;\n      if (index === 0)\n        actions.sendMessage({\n          message: { ...message },\n          target: { ...target },\n          failed: status,\n        });\n      else\n        actions.appendMessage({\n          message: { ...message },\n          target: { ...target },\n          parent: { ...parent },\n          failed: status,\n        });\n    });\n  }\n\n  function executeLocalRemove() {\n    const deletionData = {\n      target: {\n        group: chatLocation.group,\n        channel: chatLocation.channel,\n        clusterTimestamp: clusterData.clusterTimestamp,\n      },\n    };\n\n    // parent failed to send\n    if (failedIndex.includes(0)) {\n      deletionData.deleteCluster = true;\n    }\n    // child failed to send\n    else {\n      deletionData.indexes = [...failedIndex];\n    }\n\n    actions.removeClusterLocally(deletionData);\n  }\n\n  useEffect(() => {\n    const opacityTimer = setTimeout(() => {\n      setOpacity(\"opacity-0 transition-opacity duration-700\"); // why does this not work? : solution, only this component must update, does not work if nested in other component, this retry component was nested in message\n    }, 2000);\n    return () => {\n      clearTimeout(opacityTimer);\n    };\n  });\n\n  return (\n    <div\n      className={`bg-gray-500 shadow-md w-1/4 max-w-[9rem] h-6 max-h-6 m-0.5 rounded-md flex justify-around shrink-0 self-baseline relative cursor-pointer ${props.className}`}\n    >\n      <div\n        className={`w-full h-6 bg-mexican-red-400 text-center rounded-md font-semibold absolute z-10 pointer-events-none ${opacity} text-ellipsis overflow-hidden`}\n      >\n        failed to send\n      </div>\n      <span\n        title=\"delete\"\n        className=\"w-full flex rounded-l-md justify-center hover:bg-gray-400 transition-colors duration-75 group\"\n        onClick={executeLocalRemove}\n      >\n        <TrashIcon className=\"h-full py-0.5 text-gray-900\" />\n      </span>\n      <span className=\"h-3/4 self-center outline outline-1 outline-gray-800 absolute\"></span>\n      <span\n        title=\"retry\"\n        className=\"w-full flex rounded-r-md justify-center hover:bg-gray-400 transition-colors duration-75 group\"\n        onClick={executeRetry}\n      >\n        <PaperAirplaneIcon className=\"h-full py-0.5 text-gray-900 rotate-90\" />\n      </span>\n    </div>\n  );\n}\n\nfunction ImageThumbnail(props) {\n  const { imageObject, pending } = props;\n  const [imageExpanded, setImageExpanded] = useState(false);\n\n  if (pending) {\n    return (\n      <div className=\"w-36 h-24 my-1 rounded-md bg-gray-500 animate-pulse\"></div>\n    );\n  }\n\n  return (\n    <>\n      {imageExpanded ? (\n        <ImageExpandedModal\n          imgSrc={imageObject.url}\n          toggle={() => setImageExpanded(!setImageExpanded)}\n        />\n      ) : null}\n      <img\n        className=\"w-full md:w-1/2 max-w-[20rem] my-1 rounded-md cursor-pointer\"\n        src={imageObject.reduced}\n        alt=\"attached\"\n        onClick={() => setImageExpanded(!imageExpanded)}\n      />\n    </>\n  );\n}\n\nfunction Message(props) {\n  const { text, image, failed, pending, retryObject } = props;\n\n  return (\n    <div\n      className={`min-h-[1.75rem] w-full ${\n        pending || failed ? \"opacity-50\" : null\n      } flex justify-between items-center`}\n    >\n      <div className=\"w-full\">\n        {image ? (\n          <ImageThumbnail imageObject={image} pending={pending} />\n        ) : null}\n        <span className=\"w-full pr-2 font-semibold text-md text-gray-900 break-words\">\n          {text}\n        </span>\n      </div>\n      {retryObject ? (\n        <FailedActions\n          retryObject={retryObject}\n          className={pending || failed ? null : \"opacity-50\"}\n        />\n      ) : failed ? (\n        <ExclamationCircleIcon className=\"h-6 text-mexican-red-600\" />\n      ) : null}\n    </div>\n  );\n}\n\nexport default Message;\n"],"mappings":"2aAAA,OAASA,SAAS,CAAEC,QAAQ,KAAQ,OAAO,CAC3C,OACEC,iBAAiB,CACjBC,SAAS,CACTC,qBAAqB,KAChB,0BAA0B,CAEjC;AACA,OAASC,kBAAkB,KAAQ,aAAa,CAAC,6IAEjD,QAASC,cAAa,CAACC,KAAK,CAAE,CAC5B,uBAA4DA,KAAK,CAACC,WAAW,CAArEC,WAAW,oBAAXA,WAAW,CAAEC,OAAO,oBAAPA,OAAO,CAAEC,WAAW,oBAAXA,WAAW,CAAEC,YAAY,oBAAZA,YAAY,CACvD,GAAMC,QAAO,CAAGJ,WAAW,CAACI,OAAO,CACnC,cAA8BZ,QAAQ,CAAC,EAAE,CAAC,wCAAnCa,OAAO,eAAEC,UAAU,eAE1B,QAASC,aAAY,EAAG,CACtBL,WAAW,CAACM,OAAO,CAAC,SAACC,KAAK,CAAK,CAC7B,0BAA4CL,OAAO,CAACK,KAAK,CAAC,CAACC,MAAM,CAAzDC,OAAO,uBAAPA,OAAO,CAAEC,MAAM,uBAANA,MAAM,CAAEC,MAAM,uBAANA,MAAM,CAAEC,MAAM,uBAANA,MAAM,CACvC,GAAIL,KAAK,GAAK,CAAC,CACbR,OAAO,CAACc,WAAW,CAAC,CAClBJ,OAAO,kBAAOA,OAAO,CAAE,CACvBC,MAAM,kBAAOA,MAAM,CAAE,CACrBF,MAAM,CAAEG,MACV,CAAC,CAAC,CAAC,IAEHZ,QAAO,CAACe,aAAa,CAAC,CACpBL,OAAO,kBAAOA,OAAO,CAAE,CACvBC,MAAM,kBAAOA,MAAM,CAAE,CACrBE,MAAM,kBAAOA,MAAM,CAAE,CACrBJ,MAAM,CAAEG,MACV,CAAC,CAAC,CACN,CAAC,CAAC,CACJ,CAEA,QAASI,mBAAkB,EAAG,CAC5B,GAAMC,aAAY,CAAG,CACnBN,MAAM,CAAE,CACNO,KAAK,CAAEhB,YAAY,CAACgB,KAAK,CACzBC,OAAO,CAAEjB,YAAY,CAACiB,OAAO,CAC7BC,gBAAgB,CAAErB,WAAW,CAACqB,gBAChC,CACF,CAAC,CAED;AACA,GAAInB,WAAW,CAACoB,QAAQ,CAAC,CAAC,CAAC,CAAE,CAC3BJ,YAAY,CAACK,aAAa,CAAG,IAAI,CACnC,CACA;AAAA,IACK,CACHL,YAAY,CAACM,OAAO,oBAAOtB,WAAW,CAAC,CACzC,CAEAD,OAAO,CAACwB,oBAAoB,CAACP,YAAY,CAAC,CAC5C,CAEA3B,SAAS,CAAC,UAAM,CACd,GAAMmC,aAAY,CAAGC,UAAU,CAAC,UAAM,CACpCrB,UAAU,CAAC,2CAA2C,CAAC,CAAE;AAC3D,CAAC,CAAE,IAAI,CAAC,CACR,MAAO,WAAM,CACXsB,YAAY,CAACF,YAAY,CAAC,CAC5B,CAAC,CACH,CAAC,CAAC,CAEF,mBACE,aACE,SAAS,oJAA8I5B,KAAK,CAAC+B,SAAS,CAAG,wBAEzK,YACE,SAAS,gHAA0GxB,OAAO,kCAAiC,4BAGvJ,cACN,aACE,KAAK,CAAC,QAAQ,CACd,SAAS,CAAC,+FAA+F,CACzG,OAAO,CAAEY,kBAAmB,uBAE5B,KAAC,SAAS,EAAC,SAAS,CAAC,6BAA6B,EAAG,EAChD,cACP,aAAM,SAAS,CAAC,+DAA+D,EAAQ,cACvF,aACE,KAAK,CAAC,OAAO,CACb,SAAS,CAAC,+FAA+F,CACzG,OAAO,CAAEV,YAAa,uBAEtB,KAAC,iBAAiB,EAAC,SAAS,CAAC,uCAAuC,EAAG,EAClE,GACH,CAEV,CAEA,QAASuB,eAAc,CAAChC,KAAK,CAAE,CAC7B,GAAQiC,YAAW,CAAcjC,KAAK,CAA9BiC,WAAW,CAAEC,OAAO,CAAKlC,KAAK,CAAjBkC,OAAO,CAC5B,eAA0CxC,QAAQ,CAAC,KAAK,CAAC,yCAAlDyC,aAAa,eAAEC,gBAAgB,eAEtC,GAAIF,OAAO,CAAE,CACX,mBACE,YAAK,SAAS,CAAC,qDAAqD,EAAO,CAE/E,CAEA,mBACE,2BACGC,aAAa,cACZ,KAAC,kBAAkB,EACjB,MAAM,CAAEF,WAAW,CAACI,GAAI,CACxB,MAAM,CAAE,wBAAMD,iBAAgB,CAAC,CAACA,gBAAgB,CAAC,EAAC,EAClD,CACA,IAAI,cACR,YACE,SAAS,CAAC,8DAA8D,CACxE,GAAG,CAAEH,WAAW,CAACK,OAAQ,CACzB,GAAG,CAAC,UAAU,CACd,OAAO,CAAE,yBAAMF,iBAAgB,CAAC,CAACD,aAAa,CAAC,EAAC,EAChD,GACD,CAEP,CAEA,QAASI,QAAO,CAACvC,KAAK,CAAE,CACtB,GAAQwC,KAAI,CAA0CxC,KAAK,CAAnDwC,IAAI,CAAEC,KAAK,CAAmCzC,KAAK,CAA7CyC,KAAK,CAAE7B,MAAM,CAA2BZ,KAAK,CAAtCY,MAAM,CAAEsB,OAAO,CAAkBlC,KAAK,CAA9BkC,OAAO,CAAEjC,WAAW,CAAKD,KAAK,CAArBC,WAAW,CAEjD,mBACE,aACE,SAAS,kCACPiC,OAAO,EAAItB,MAAM,CAAG,YAAY,CAAG,IAAI,sCACJ,wBAErC,aAAK,SAAS,CAAC,QAAQ,WACpB6B,KAAK,cACJ,KAAC,cAAc,EAAC,WAAW,CAAEA,KAAM,CAAC,OAAO,CAAEP,OAAQ,EAAG,CACtD,IAAI,cACR,aAAM,SAAS,CAAC,6DAA6D,UAC1EM,IAAI,EACA,GACH,CACLvC,WAAW,cACV,KAAC,aAAa,EACZ,WAAW,CAAEA,WAAY,CACzB,SAAS,CAAEiC,OAAO,EAAItB,MAAM,CAAG,IAAI,CAAG,YAAa,EACnD,CACAA,MAAM,cACR,KAAC,qBAAqB,EAAC,SAAS,CAAC,0BAA0B,EAAG,CAC5D,IAAI,GACJ,CAEV,CAEA,cAAe2B,QAAO"},"metadata":{},"sourceType":"module","externalDependencies":[]}