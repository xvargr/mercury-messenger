{"ast":null,"code":"var _jsxFileName = \"/home/agreus/Documents/webdev/mercury-messenger/client/src/components/chat/Message.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport { useEffect, useState } from \"react\";\nimport { PaperAirplaneIcon, TrashIcon, ExclamationCircleIcon } from \"@heroicons/react/outline\";\n\n// modal\nimport { ImageExpandedModal } from \"../ui/Modal\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nfunction FailedActions(props) {\n  _s();\n  const {\n    clusterData,\n    actions,\n    failedIndex,\n    chatLocation\n  } = props.retryObject;\n  const content = clusterData.content;\n  const [opacity, setOpacity] = useState(\"\");\n  function executeRetry() {\n    failedIndex.forEach(index => {\n      const {\n        message,\n        target,\n        status,\n        parent\n      } = content[index].failed;\n      if (index === 0) actions.sendMessage({\n        message: {\n          ...message\n        },\n        target: {\n          ...target\n        },\n        failed: status\n      });else actions.appendMessage({\n        message: {\n          ...message\n        },\n        target: {\n          ...target\n        },\n        parent: {\n          ...parent\n        },\n        failed: status\n      });\n    });\n  }\n  function executeLocalRemove() {\n    const deletionData = {\n      target: {\n        group: chatLocation.group,\n        channel: chatLocation.channel,\n        clusterTimestamp: clusterData.clusterTimestamp\n      }\n    };\n\n    // parent failed to send\n    if (failedIndex.includes(0)) {\n      deletionData.deleteCluster = true;\n    }\n    // child failed to send\n    else {\n      deletionData.indexes = [...failedIndex];\n    }\n    actions.removeClusterLocally(deletionData);\n  }\n  useEffect(() => {\n    const opacityTimer = setTimeout(() => {\n      setOpacity(\"opacity-0 transition-opacity duration-700\"); // why does this not work? : solution, only this component must update, does not work if nested in other component, this retry component was nested in message\n    }, 2000);\n    return () => {\n      clearTimeout(opacityTimer);\n    };\n  });\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: `bg-gray-500 shadow-md w-1/4 max-w-[9rem] h-6 max-h-6 m-0.5 rounded-md flex justify-around shrink-0 self-baseline relative cursor-pointer ${props.className}`,\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: `w-full h-6 bg-mexican-red-400 text-center rounded-md font-semibold absolute z-10 pointer-events-none ${opacity} text-ellipsis overflow-hidden`,\n      children: \"failed to send\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 69,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n      title: \"delete\",\n      className: \"w-full flex rounded-l-md justify-center hover:bg-gray-400 transition-colors duration-75 group\",\n      onClick: executeLocalRemove,\n      children: /*#__PURE__*/_jsxDEV(TrashIcon, {\n        className: \"h-full py-0.5 text-gray-900\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 79,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n      className: \"h-3/4 self-center outline outline-1 outline-gray-800 absolute\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n      title: \"retry\",\n      className: \"w-full flex rounded-r-md justify-center hover:bg-gray-400 transition-colors duration-75 group\",\n      onClick: executeRetry,\n      children: /*#__PURE__*/_jsxDEV(PaperAirplaneIcon, {\n        className: \"h-full py-0.5 text-gray-900 rotate-90\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 87,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 66,\n    columnNumber: 5\n  }, this);\n}\n_s(FailedActions, \"GTO+2uNYZiEaOCVp0L1YQztlT8g=\");\n_c = FailedActions;\nfunction ImageThumbnail(props) {\n  _s2();\n  const {\n    imageObject,\n    pending\n  } = props;\n  const [imageExpanded, setImageExpanded] = useState(false);\n  if (pending) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"w-36 h-24 my-1 rounded-md bg-gray-500 animate-pulse\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [imageExpanded ? /*#__PURE__*/_jsxDEV(ImageExpandedModal, {\n      imgSrc: imageObject.url,\n      toggle: () => setImageExpanded(!setImageExpanded)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 9\n    }, this) : null, /*#__PURE__*/_jsxDEV(\"img\", {\n      className: \"w-full md:w-1/2 max-w-[20rem] my-1 rounded-md cursor-pointer\",\n      src: imageObject.reduced,\n      alt: \"attached\",\n      onClick: () => setImageExpanded(!imageExpanded)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n}\n_s2(ImageThumbnail, \"StV2IV1ThuiA43HFzUbzrw1WZbM=\");\n_c2 = ImageThumbnail;\nfunction Message(props) {\n  const {\n    text,\n    image,\n    failed,\n    pending,\n    retryObject\n  } = props;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: `min-h-[1.75rem] w-full ${pending || failed ? \"opacity-50\" : null} flex justify-between items-center`,\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"w-full\",\n      children: [image ? /*#__PURE__*/_jsxDEV(ImageThumbnail, {\n        imageObject: image,\n        pending: pending\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 11\n      }, this) : null, /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"w-full pr-2 font-semibold text-md text-gray-900 break-words\",\n        children: text\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 7\n    }, this), retryObject ? /*#__PURE__*/_jsxDEV(FailedActions, {\n      retryObject: retryObject,\n      className: pending || failed ? null : \"opacity-50\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 9\n    }, this) : failed ? /*#__PURE__*/_jsxDEV(ExclamationCircleIcon, {\n      className: \"h-6 text-mexican-red-600\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 144,\n      columnNumber: 9\n    }, this) : null]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 125,\n    columnNumber: 5\n  }, this);\n}\n_c3 = Message;\nexport default Message;\nvar _c, _c2, _c3;\n$RefreshReg$(_c, \"FailedActions\");\n$RefreshReg$(_c2, \"ImageThumbnail\");\n$RefreshReg$(_c3, \"Message\");","map":{"version":3,"names":["useEffect","useState","PaperAirplaneIcon","TrashIcon","ExclamationCircleIcon","ImageExpandedModal","FailedActions","props","clusterData","actions","failedIndex","chatLocation","retryObject","content","opacity","setOpacity","executeRetry","forEach","index","message","target","status","parent","failed","sendMessage","appendMessage","executeLocalRemove","deletionData","group","channel","clusterTimestamp","includes","deleteCluster","indexes","removeClusterLocally","opacityTimer","setTimeout","clearTimeout","className","ImageThumbnail","imageObject","pending","imageExpanded","setImageExpanded","url","reduced","Message","text","image"],"sources":["/home/agreus/Documents/webdev/mercury-messenger/client/src/components/chat/Message.js"],"sourcesContent":["import { useEffect, useState } from \"react\";\nimport {\n  PaperAirplaneIcon,\n  TrashIcon,\n  ExclamationCircleIcon,\n} from \"@heroicons/react/outline\";\n\n// modal\nimport { ImageExpandedModal } from \"../ui/Modal\";\n\nfunction FailedActions(props) {\n  const { clusterData, actions, failedIndex, chatLocation } = props.retryObject;\n  const content = clusterData.content;\n  const [opacity, setOpacity] = useState(\"\");\n\n  function executeRetry() {\n    failedIndex.forEach((index) => {\n      const { message, target, status, parent } = content[index].failed;\n      if (index === 0)\n        actions.sendMessage({\n          message: { ...message },\n          target: { ...target },\n          failed: status,\n        });\n      else\n        actions.appendMessage({\n          message: { ...message },\n          target: { ...target },\n          parent: { ...parent },\n          failed: status,\n        });\n    });\n  }\n\n  function executeLocalRemove() {\n    const deletionData = {\n      target: {\n        group: chatLocation.group,\n        channel: chatLocation.channel,\n        clusterTimestamp: clusterData.clusterTimestamp,\n      },\n    };\n\n    // parent failed to send\n    if (failedIndex.includes(0)) {\n      deletionData.deleteCluster = true;\n    }\n    // child failed to send\n    else {\n      deletionData.indexes = [...failedIndex];\n    }\n\n    actions.removeClusterLocally(deletionData);\n  }\n\n  useEffect(() => {\n    const opacityTimer = setTimeout(() => {\n      setOpacity(\"opacity-0 transition-opacity duration-700\"); // why does this not work? : solution, only this component must update, does not work if nested in other component, this retry component was nested in message\n    }, 2000);\n    return () => {\n      clearTimeout(opacityTimer);\n    };\n  });\n\n  return (\n    <div\n      className={`bg-gray-500 shadow-md w-1/4 max-w-[9rem] h-6 max-h-6 m-0.5 rounded-md flex justify-around shrink-0 self-baseline relative cursor-pointer ${props.className}`}\n    >\n      <div\n        className={`w-full h-6 bg-mexican-red-400 text-center rounded-md font-semibold absolute z-10 pointer-events-none ${opacity} text-ellipsis overflow-hidden`}\n      >\n        failed to send\n      </div>\n      <span\n        title=\"delete\"\n        className=\"w-full flex rounded-l-md justify-center hover:bg-gray-400 transition-colors duration-75 group\"\n        onClick={executeLocalRemove}\n      >\n        <TrashIcon className=\"h-full py-0.5 text-gray-900\" />\n      </span>\n      <span className=\"h-3/4 self-center outline outline-1 outline-gray-800 absolute\"></span>\n      <span\n        title=\"retry\"\n        className=\"w-full flex rounded-r-md justify-center hover:bg-gray-400 transition-colors duration-75 group\"\n        onClick={executeRetry}\n      >\n        <PaperAirplaneIcon className=\"h-full py-0.5 text-gray-900 rotate-90\" />\n      </span>\n    </div>\n  );\n}\n\nfunction ImageThumbnail(props) {\n  const { imageObject, pending } = props;\n  const [imageExpanded, setImageExpanded] = useState(false);\n\n  if (pending) {\n    return (\n      <div className=\"w-36 h-24 my-1 rounded-md bg-gray-500 animate-pulse\"></div>\n    );\n  }\n\n  return (\n    <>\n      {imageExpanded ? (\n        <ImageExpandedModal\n          imgSrc={imageObject.url}\n          toggle={() => setImageExpanded(!setImageExpanded)}\n        />\n      ) : null}\n      <img\n        className=\"w-full md:w-1/2 max-w-[20rem] my-1 rounded-md cursor-pointer\"\n        src={imageObject.reduced}\n        alt=\"attached\"\n        onClick={() => setImageExpanded(!imageExpanded)}\n      />\n    </>\n  );\n}\n\nfunction Message(props) {\n  const { text, image, failed, pending, retryObject } = props;\n\n  return (\n    <div\n      className={`min-h-[1.75rem] w-full ${\n        pending || failed ? \"opacity-50\" : null\n      } flex justify-between items-center`}\n    >\n      <div className=\"w-full\">\n        {image ? (\n          <ImageThumbnail imageObject={image} pending={pending} />\n        ) : null}\n        <span className=\"w-full pr-2 font-semibold text-md text-gray-900 break-words\">\n          {text}\n        </span>\n      </div>\n      {retryObject ? (\n        <FailedActions\n          retryObject={retryObject}\n          className={pending || failed ? null : \"opacity-50\"}\n        />\n      ) : failed ? (\n        <ExclamationCircleIcon className=\"h-6 text-mexican-red-600\" />\n      ) : null}\n    </div>\n  );\n}\n\nexport default Message;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}